!---------------------------------------------
! Configuration de base et Securite
!---------------------------------------------
enable
configure terminal
hostname R1
no ip domain lookup
ip domain-name labo-NAT.com
enable secret class
security password min-length 5
service password-encryption

username admin secret admin123
banner motd "Acces reserve aux administrateurs - R1"

!---------------------------------------------
! ACLs de Politique de Securite
!---------------------------------------------
!---------------------------------------------
! Seul le VLAN MGNT (172.16.30.0) peut se connecter en SSH
!---------------------------------------------

ip access-list standard ACL-ADMIN-ONLY
 permit 172.16.30.0 0.0.0.255
exit

!---------------------------------------------
! ACL VLAN 10 : Acces Internet + Acces R&D (10.10.10.1)
!---------------------------------------------

ip access-list extended ACL-VLAN10
 permit ip 172.16.10.0 0.0.0.255 host 10.10.10.1 
 deny ip 172.16.10.0 0.0.0.255 172.16.20.0 0.0.0.255 
 deny ip 172.16.10.0 0.0.0.255 172.16.30.0 0.0.0.255 
 permit ip any any                                     
exit

!---------------------------------------------
! ACL pour le VLAN 20 (STAFF)
!---------------------------------------------

ip access-list extended ACL-VLAN20
 deny ip 172.16.20.0 0.0.0.255 host 10.10.10.1        
 deny ip 172.16.20.0 0.0.0.255 172.16.10.0 0.0.0.255  
 deny ip 172.16.20.0 0.0.0.255 172.16.30.0 0.0.0.255  
 permit ip any any                                     
exit

!---------------------------------------------
! ACL pour le VLAN 30 (MGNT)
!---------------------------------------------

ip access-list extended ACL-VLAN30
 deny ip 172.16.30.0 0.0.0.255 172.16.10.0 0.0.0.255  
 deny ip 172.16.30.0 0.0.0.255 172.16.20.0 0.0.0.255  
 permit ip any any                                     
exit


!---------------------------------------------
! ACL pour le VLAN 40 : PC0 - Acces Internet (Bloque R&D)
!---------------------------------------------

ip access-list extended ACL-VLAN40
 deny ip 172.16.40.0 0.0.0.255 host 10.10.10.1
 permit ip any any
exit

!---------------------------------------------
! Configuration des Lignes (Console et SSH)
!---------------------------------------------
line console 0
 password cisco
 login
exit

!---------------------------------------------
! Generation de la cle pour SSH
!---------------------------------------------

crypto key generate rsa


line vty 0 15
 login local
 transport input ssh
 access-class ACL-ADMIN-ONLY in
exit

!---------------------------------------------
! Configuration des sous-interfaces (LAN)
!---------------------------------------------
interface g0/0
 description LIAISON_VERS_S1
 no shutdown
exit

interface g0/0.10
 description VLAN_RD
 encapsulation dot1Q 10
 ip address 172.16.10.2 255.255.255.0
 ip access-group ACL-VLAN10 in
 ip helper-address 10.10.13.2
 standby 10 ip 172.16.10.1
 standby 10 priority 110
 standby 10 preempt
exit

interface g0/0.20
 description VLAN_STAFF
 encapsulation dot1Q 20
 ip address 172.16.20.2 255.255.255.0
 ip access-group ACL-VLAN20 in
 ip helper-address 10.10.13.2
 standby 20 ip 172.16.20.1
 standby 20 priority 110
 standby 20 preempt
exit

interface g0/0.30
 description VLAN_MGNT
 encapsulation dot1Q 30
 ip address 172.16.30.2 255.255.255.0
 ip access-group ACL-VLAN30 in
 ip helper-address 10.10.13.2
 standby 30 ip 172.16.30.1
 standby 30 priority 110
 standby 30 preempt
exit

interface g0/0.40
 description VLAN_OSPF_PC0
 encapsulation dot1Q 40
 ip address 172.16.40.2 255.255.255.0
 ip access-group ACL-VLAN40 in
 ip helper-address 10.10.13.2
 standby 40 ip 172.16.40.1
 standby 40 priority 110
 standby 40 preempt
exit

interface g0/0.99
 description VLAN_NATIF
 encapsulation dot1Q 99 native
exit

!---------------------------------------------
! Configuration Interface WAN
!---------------------------------------------
interface g0/1
 description LINK_TO_POD-X-R1
 ip address 10.10.13.1 255.255.255.252
 no shutdown
exit

!---------------------------------------------
! Routage Dynamique OSPF
!---------------------------------------------
router ospf 1
 router-id 1.1.1.1
 network 172.16.10.0 0.0.0.255 area 0
 network 172.16.20.0 0.0.0.255 area 0
 network 172.16.30.0 0.0.0.255 area 0
 network 172.16.40.0 0.0.0.255 area 0
 network 10.10.13.0 0.0.0.3 area 0
exit

end
