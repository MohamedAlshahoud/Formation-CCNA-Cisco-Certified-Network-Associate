!---------------------------------------------
! Configuration de base et Securite
!---------------------------------------------
enable
configure terminal
hostname POD-X-R1
no ip domain-lookup
ip domain-name labo-NAT.com
enable secret class
security password min-length 5
service password-encryption

username admin secret admin123
banner motd "Acces reserve aux administrateurs - POD-X-R1"

!---------------------------------------------
! ACL de restriction Management
!---------------------------------------------
!---------------------------------------------
! Seul le VLAN MGNT (172.16.30.0) peut se connecter en SSH
!---------------------------------------------

ip access-list standard ACL-ADMIN-ONLY
 permit 172.16.30.0 0.0.0.255
exit

!---------------------------------------------
! Configuration des Lignes (Console et SSH)
!---------------------------------------------
line console 0
 password cisco
 login
exit


!---------------------------------------------
! Generation de la cle pour SSH
!---------------------------------------------

crypto key generate rsa


line vty 0 15
 login local
 transport input ssh
 access-class ACL-ADMIN-ONLY in
exit

!---------------------------------------------
! Serveur DHCP - Configuration des Pools
!---------------------------------------------
!---------------------------------------------
! Exclusion des adresses de passerelles et des routeurs
!---------------------------------------------

ip dhcp excluded-address 172.16.10.1 172.16.10.10
ip dhcp excluded-address 172.16.20.1 172.16.20.10
ip dhcp excluded-address 172.16.30.1 172.16.30.10
ip dhcp excluded-address 172.16.40.1 172.16.40.10


!---------------------------------------------
! Pool pour le VLAN 10 (R&D)
!---------------------------------------------

ip dhcp pool POOL_VLAN10
 network 172.16.10.0 255.255.255.0
 default-router 172.16.10.1
 dns-server 8.8.8.8

!---------------------------------------------
! Pool pour le VLAN 20 (STAFF)
!---------------------------------------------

ip dhcp pool POOL_VLAN20
 network 172.16.20.0 255.255.255.0
 default-router 172.16.20.1
 dns-server 8.8.8.8


!---------------------------------------------
! Pool pour le VLAN 30 (MGNT)
!---------------------------------------------

ip dhcp pool POOL_VLAN30
 network 172.16.30.0 255.255.255.0
 default-router 172.16.30.1
 dns-server 8.8.8.8

!---------------------------------------------
! Pool pour le VLAN 40
!---------------------------------------------

network 172.16.40.0 255.255.255.0
 default-router 172.16.40.1
 dns-server 8.8.8.8


!---------------------------------------------
! Interfaces WAN et Loopbacks
!---------------------------------------------
interface g0/0
 description LIEN_VERS_R1
 ip address 10.10.13.2 255.255.255.252
 no shutdown
exit

interface g0/1
 description LIEN_VERS_R2
 ip address 10.10.23.2 255.255.255.252
 no shutdown
exit


!---------------------------------------------
! Interfaces LAN (Inside NAT)
!---------------------------------------------

interface Loopback0
 description RESEAU_RD_INTERNE
 ip address 10.10.10.1 255.255.255.255

interface GigabitEthernet0/0
 description VERS_R1
 ip address 10.10.13.2 255.255.255.252
 ip nat inside
 no shutdown

interface GigabitEthernet0/1
 description VERS_R2
 ip address 10.10.23.2 255.255.255.252
 ip nat inside
 no shutdown

!---------------------------------------------
! Interface WAN (Outside NAT)
!---------------------------------------------
interface GigabitEthernet0/2
 description VERS_ISP
 ip address 209.165.200.225 255.255.255.224
 ip nat outside
 no shutdown

!---------------------------------------------
! Routage OSPF et Statique
!---------------------------------------------
router ospf 1
 router-id 3.3.3.3
 network 10.10.13.0 0.0.0.3 area 0
 network 10.10.23.0 0.0.0.3 area 0
 network 10.10.10.1 0.0.0.0 area 0
 default-information originate

ip route 0.0.0.0 0.0.0.0 GigabitEthernet0/2

!---------------------------------------------
! Configuration NAT
!---------------------------------------------
!---------------------------------------------
! NAT Statique pour PC2
!---------------------------------------------

ip nat inside source static 172.16.20.11 209.165.200.227

!---------------------------------------------
! PAT (NAT Overload) pour tous les VLANs
!---------------------------------------------

ip nat inside source list 1 interface GigabitEthernet0/2 overload

access-list 1 permit 172.16.10.0 0.0.0.255
access-list 1 permit 172.16.20.0 0.0.0.255
access-list 1 permit 172.16.30.0 0.0.0.255
access-list 1 permit 172.16.40.0 0.0.0.255

end
